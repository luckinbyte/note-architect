<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>购物车 | JAVA 架构师笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/note-architect/favicon.ico">
    <link rel="manifest" href="/note-architect/manifest.json">
    <meta name="description" content="用来记录架构师相关成套的知识">
    
    <link rel="preload" href="/note-architect/assets/css/0.styles.40de79f3.css" as="style"><link rel="preload" href="/note-architect/assets/js/app.802a2e28.js" as="script"><link rel="preload" href="/note-architect/assets/js/2.c5658f11.js" as="script"><link rel="preload" href="/note-architect/assets/js/45.43ef5aaf.js" as="script"><link rel="preload" href="/note-architect/assets/js/49.c0fbdc86.js" as="script"><link rel="prefetch" href="/note-architect/assets/js/10.038bd2f4.js"><link rel="prefetch" href="/note-architect/assets/js/100.fc44c5c8.js"><link rel="prefetch" href="/note-architect/assets/js/101.d6ddaa00.js"><link rel="prefetch" href="/note-architect/assets/js/102.c2404ad0.js"><link rel="prefetch" href="/note-architect/assets/js/103.8c0b467f.js"><link rel="prefetch" href="/note-architect/assets/js/104.a868e36f.js"><link rel="prefetch" href="/note-architect/assets/js/105.3cb3e1f1.js"><link rel="prefetch" href="/note-architect/assets/js/106.9b2b7410.js"><link rel="prefetch" href="/note-architect/assets/js/107.bf95d31c.js"><link rel="prefetch" href="/note-architect/assets/js/108.105ebbf6.js"><link rel="prefetch" href="/note-architect/assets/js/109.6a712361.js"><link rel="prefetch" href="/note-architect/assets/js/11.29b6711f.js"><link rel="prefetch" href="/note-architect/assets/js/110.a1b792d6.js"><link rel="prefetch" href="/note-architect/assets/js/111.28f776f9.js"><link rel="prefetch" href="/note-architect/assets/js/112.2f670e54.js"><link rel="prefetch" href="/note-architect/assets/js/113.4edaed31.js"><link rel="prefetch" href="/note-architect/assets/js/114.e41a52b2.js"><link rel="prefetch" href="/note-architect/assets/js/115.61de6b4a.js"><link rel="prefetch" href="/note-architect/assets/js/116.92db9f4a.js"><link rel="prefetch" href="/note-architect/assets/js/117.7d8aa021.js"><link rel="prefetch" href="/note-architect/assets/js/118.3edc1e2c.js"><link rel="prefetch" href="/note-architect/assets/js/119.d9d900c0.js"><link rel="prefetch" href="/note-architect/assets/js/12.af831555.js"><link rel="prefetch" href="/note-architect/assets/js/120.38d947f2.js"><link rel="prefetch" href="/note-architect/assets/js/121.68a835c1.js"><link rel="prefetch" href="/note-architect/assets/js/122.8d1af96b.js"><link rel="prefetch" href="/note-architect/assets/js/123.478593b1.js"><link rel="prefetch" href="/note-architect/assets/js/124.449b42a5.js"><link rel="prefetch" href="/note-architect/assets/js/125.52be7b0c.js"><link rel="prefetch" href="/note-architect/assets/js/126.70dbe62e.js"><link rel="prefetch" href="/note-architect/assets/js/127.d95ea977.js"><link rel="prefetch" href="/note-architect/assets/js/128.8f0c0f9b.js"><link rel="prefetch" href="/note-architect/assets/js/129.4124e2f0.js"><link rel="prefetch" href="/note-architect/assets/js/13.dc9b0de9.js"><link rel="prefetch" href="/note-architect/assets/js/130.0a168309.js"><link rel="prefetch" href="/note-architect/assets/js/131.c5ead1a0.js"><link rel="prefetch" href="/note-architect/assets/js/132.d2ea7534.js"><link rel="prefetch" href="/note-architect/assets/js/133.99d3b899.js"><link rel="prefetch" href="/note-architect/assets/js/134.585e0c4b.js"><link rel="prefetch" href="/note-architect/assets/js/135.2939b773.js"><link rel="prefetch" href="/note-architect/assets/js/136.40e330a3.js"><link rel="prefetch" href="/note-architect/assets/js/137.cc77c2a2.js"><link rel="prefetch" href="/note-architect/assets/js/138.dcccdebc.js"><link rel="prefetch" href="/note-architect/assets/js/139.fa88b1d0.js"><link rel="prefetch" href="/note-architect/assets/js/14.bf3fade4.js"><link rel="prefetch" href="/note-architect/assets/js/140.899e432e.js"><link rel="prefetch" href="/note-architect/assets/js/141.b604c177.js"><link rel="prefetch" href="/note-architect/assets/js/142.b2623ea4.js"><link rel="prefetch" href="/note-architect/assets/js/143.bba5b5c1.js"><link rel="prefetch" href="/note-architect/assets/js/144.1f522ea7.js"><link rel="prefetch" href="/note-architect/assets/js/145.c4fe8713.js"><link rel="prefetch" href="/note-architect/assets/js/146.dccb50ff.js"><link rel="prefetch" href="/note-architect/assets/js/147.50c25c20.js"><link rel="prefetch" href="/note-architect/assets/js/148.b902dfb5.js"><link rel="prefetch" href="/note-architect/assets/js/149.470b96c8.js"><link rel="prefetch" href="/note-architect/assets/js/15.a8e38bb8.js"><link rel="prefetch" href="/note-architect/assets/js/150.fa139f6f.js"><link rel="prefetch" href="/note-architect/assets/js/151.4983ec0a.js"><link rel="prefetch" href="/note-architect/assets/js/152.f1a81e90.js"><link rel="prefetch" href="/note-architect/assets/js/153.3321ef67.js"><link rel="prefetch" href="/note-architect/assets/js/154.b84ed6b9.js"><link rel="prefetch" href="/note-architect/assets/js/155.171fb3b5.js"><link rel="prefetch" href="/note-architect/assets/js/156.5ca76a29.js"><link rel="prefetch" href="/note-architect/assets/js/157.0111e24a.js"><link rel="prefetch" href="/note-architect/assets/js/158.d9895956.js"><link rel="prefetch" href="/note-architect/assets/js/159.907d1b38.js"><link rel="prefetch" href="/note-architect/assets/js/16.39fa402f.js"><link rel="prefetch" href="/note-architect/assets/js/160.2ea29a4f.js"><link rel="prefetch" href="/note-architect/assets/js/161.e51df7aa.js"><link rel="prefetch" href="/note-architect/assets/js/162.06b72fae.js"><link rel="prefetch" href="/note-architect/assets/js/163.fc5cdf96.js"><link rel="prefetch" href="/note-architect/assets/js/164.3d0ea04b.js"><link rel="prefetch" href="/note-architect/assets/js/165.fad9b58f.js"><link rel="prefetch" href="/note-architect/assets/js/166.6cefe279.js"><link rel="prefetch" href="/note-architect/assets/js/17.bf07d804.js"><link rel="prefetch" href="/note-architect/assets/js/18.07dc5bdc.js"><link rel="prefetch" href="/note-architect/assets/js/19.a85dec67.js"><link rel="prefetch" href="/note-architect/assets/js/20.9df8f68a.js"><link rel="prefetch" href="/note-architect/assets/js/21.78f29c8e.js"><link rel="prefetch" href="/note-architect/assets/js/22.79434bbc.js"><link rel="prefetch" href="/note-architect/assets/js/23.5c161369.js"><link rel="prefetch" href="/note-architect/assets/js/24.fb99210d.js"><link rel="prefetch" href="/note-architect/assets/js/25.121dc1ac.js"><link rel="prefetch" href="/note-architect/assets/js/26.d9a1e563.js"><link rel="prefetch" href="/note-architect/assets/js/27.aa7847c4.js"><link rel="prefetch" href="/note-architect/assets/js/28.d9165cf0.js"><link rel="prefetch" href="/note-architect/assets/js/29.c375185e.js"><link rel="prefetch" href="/note-architect/assets/js/3.82a12f44.js"><link rel="prefetch" href="/note-architect/assets/js/30.7077de2f.js"><link rel="prefetch" href="/note-architect/assets/js/31.c0a05c83.js"><link rel="prefetch" href="/note-architect/assets/js/32.35c6ff4d.js"><link rel="prefetch" href="/note-architect/assets/js/33.5094c396.js"><link rel="prefetch" href="/note-architect/assets/js/34.f3fc3771.js"><link rel="prefetch" href="/note-architect/assets/js/35.8c8f3676.js"><link rel="prefetch" href="/note-architect/assets/js/36.695633ac.js"><link rel="prefetch" href="/note-architect/assets/js/37.d6240666.js"><link rel="prefetch" href="/note-architect/assets/js/38.1df53f36.js"><link rel="prefetch" href="/note-architect/assets/js/39.92c722fe.js"><link rel="prefetch" href="/note-architect/assets/js/4.22e0c41e.js"><link rel="prefetch" href="/note-architect/assets/js/40.59a891fb.js"><link rel="prefetch" href="/note-architect/assets/js/41.db5bd8a6.js"><link rel="prefetch" href="/note-architect/assets/js/42.aa467f7a.js"><link rel="prefetch" href="/note-architect/assets/js/43.c1c328a0.js"><link rel="prefetch" href="/note-architect/assets/js/44.5f99d5c0.js"><link rel="prefetch" href="/note-architect/assets/js/46.985a6532.js"><link rel="prefetch" href="/note-architect/assets/js/47.b03937ac.js"><link rel="prefetch" href="/note-architect/assets/js/48.a829dba9.js"><link rel="prefetch" href="/note-architect/assets/js/5.335b38b2.js"><link rel="prefetch" href="/note-architect/assets/js/50.55a20ce0.js"><link rel="prefetch" href="/note-architect/assets/js/51.0b9d082d.js"><link rel="prefetch" href="/note-architect/assets/js/52.31e36b5e.js"><link rel="prefetch" href="/note-architect/assets/js/53.cf02d0bf.js"><link rel="prefetch" href="/note-architect/assets/js/54.46f98077.js"><link rel="prefetch" href="/note-architect/assets/js/55.bae22541.js"><link rel="prefetch" href="/note-architect/assets/js/56.675a88ec.js"><link rel="prefetch" href="/note-architect/assets/js/57.73c054a7.js"><link rel="prefetch" href="/note-architect/assets/js/58.066cdd65.js"><link rel="prefetch" href="/note-architect/assets/js/59.f624c81a.js"><link rel="prefetch" href="/note-architect/assets/js/6.1815f9e0.js"><link rel="prefetch" href="/note-architect/assets/js/60.4ec97ade.js"><link rel="prefetch" href="/note-architect/assets/js/61.2d30af4e.js"><link rel="prefetch" href="/note-architect/assets/js/62.a6f0c63c.js"><link rel="prefetch" href="/note-architect/assets/js/63.aab63fa8.js"><link rel="prefetch" href="/note-architect/assets/js/64.2d7e132f.js"><link rel="prefetch" href="/note-architect/assets/js/65.8e8c1a4f.js"><link rel="prefetch" href="/note-architect/assets/js/66.a151a66d.js"><link rel="prefetch" href="/note-architect/assets/js/67.68bdef69.js"><link rel="prefetch" href="/note-architect/assets/js/68.94567caa.js"><link rel="prefetch" href="/note-architect/assets/js/69.ba8d09fe.js"><link rel="prefetch" href="/note-architect/assets/js/7.34eb2a5e.js"><link rel="prefetch" href="/note-architect/assets/js/70.d7f353a7.js"><link rel="prefetch" href="/note-architect/assets/js/71.8565b766.js"><link rel="prefetch" href="/note-architect/assets/js/72.6de13f5f.js"><link rel="prefetch" href="/note-architect/assets/js/73.fef0b259.js"><link rel="prefetch" href="/note-architect/assets/js/74.447be4ac.js"><link rel="prefetch" href="/note-architect/assets/js/75.ad821c96.js"><link rel="prefetch" href="/note-architect/assets/js/76.f142121f.js"><link rel="prefetch" href="/note-architect/assets/js/77.5b09b27c.js"><link rel="prefetch" href="/note-architect/assets/js/78.831355de.js"><link rel="prefetch" href="/note-architect/assets/js/79.0c33d6bd.js"><link rel="prefetch" href="/note-architect/assets/js/8.5216941d.js"><link rel="prefetch" href="/note-architect/assets/js/80.38372191.js"><link rel="prefetch" href="/note-architect/assets/js/81.6ff68f48.js"><link rel="prefetch" href="/note-architect/assets/js/82.d6b0d436.js"><link rel="prefetch" href="/note-architect/assets/js/83.33a665f1.js"><link rel="prefetch" href="/note-architect/assets/js/84.8cf13177.js"><link rel="prefetch" href="/note-architect/assets/js/85.7f57a85f.js"><link rel="prefetch" href="/note-architect/assets/js/86.a4e08824.js"><link rel="prefetch" href="/note-architect/assets/js/87.30e592e4.js"><link rel="prefetch" href="/note-architect/assets/js/88.29d90381.js"><link rel="prefetch" href="/note-architect/assets/js/89.670570cf.js"><link rel="prefetch" href="/note-architect/assets/js/9.84f1b2c0.js"><link rel="prefetch" href="/note-architect/assets/js/90.6667fd66.js"><link rel="prefetch" href="/note-architect/assets/js/91.6a90cf9b.js"><link rel="prefetch" href="/note-architect/assets/js/92.1ac7174d.js"><link rel="prefetch" href="/note-architect/assets/js/93.162baa9d.js"><link rel="prefetch" href="/note-architect/assets/js/94.961c55b0.js"><link rel="prefetch" href="/note-architect/assets/js/95.3b84241e.js"><link rel="prefetch" href="/note-architect/assets/js/96.f7f0df08.js"><link rel="prefetch" href="/note-architect/assets/js/97.01e2417b.js"><link rel="prefetch" href="/note-architect/assets/js/98.a4a96a8d.js"><link rel="prefetch" href="/note-architect/assets/js/99.7300aff8.js">
    <link rel="stylesheet" href="/note-architect/assets/css/0.styles.40de79f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-architect/" class="home-link router-link-active"><img src="/note-architect/mlogo.svg" alt="JAVA 架构师笔记" class="logo"> <span class="site-name can-hide">JAVA 架构师笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-architect/hc/" class="nav-link">
  高并发系统设计 40 问
</a></div><div class="nav-item"><a href="/note-architect/ztc/" class="nav-link router-link-active">
  JAVA 架构师直通车
</a></div> <a href="https://github.com/zq99299/note-architect" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-architect/hc/" class="nav-link">
  高并发系统设计 40 问
</a></div><div class="nav-item"><a href="/note-architect/ztc/" class="nav-link router-link-active">
  JAVA 架构师直通车
</a></div> <a href="https://github.com/zq99299/note-architect" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/note-architect/ztc/" aria-current="page" class="sidebar-link">JAVA 架构师直通车</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/00/" class="sidebar-heading clickable"><span>开篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/01/" class="sidebar-heading clickable"><span>01 | 万丈高楼，地基首要</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/02/" class="sidebar-heading clickable router-link-active open"><span>02 | 分类、推荐、搜索、评价、购物车开发</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/note-architect/ztc/02/" aria-current="page" class="sidebar-link">02 | 分类、推荐、搜索、评价、购物车开发</a></li><li><a href="/note-architect/ztc/02/01.html" class="sidebar-link">首页轮播图功能开发</a></li><li><a href="/note-architect/ztc/02/02.html" class="sidebar-link">商品分类实现</a></li><li><a href="/note-architect/ztc/02/03.html" class="sidebar-link">分类商品推荐</a></li><li><a href="/note-architect/ztc/02/04.html" class="sidebar-link">商品详情页</a></li><li><a href="/note-architect/ztc/02/05.html" class="sidebar-link">商品评价</a></li><li><a href="/note-architect/ztc/02/06.html" class="sidebar-link">搜索商品</a></li><li><a href="/note-architect/ztc/02/07.html" aria-current="page" class="active sidebar-link">购物车</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#购物车存储形式分析" class="sidebar-link">购物车存储形式分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#session" class="sidebar-link">Session</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#数据库" class="sidebar-link">数据库</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#redis" class="sidebar-link">redis</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#技术方案确定" class="sidebar-link">技术方案确定</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#添加商品到购物车" class="sidebar-link">添加商品到购物车</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#前端代码示例" class="sidebar-link">前端代码示例</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#后端保存购物数据接口" class="sidebar-link">后端保存购物数据接口</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#小结" class="sidebar-link">小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#购物车页面" class="sidebar-link">购物车页面</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#购物车页面-刷新渲染" class="sidebar-link">购物车页面-刷新渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#前端代码" class="sidebar-link">前端代码</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#查询最新商品数据接口" class="sidebar-link">查询最新商品数据接口</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#购物车页面-选中商品业务" class="sidebar-link">购物车页面-选中商品业务</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#购物车页面-删除商品业务" class="sidebar-link">购物车页面-删除商品业务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#前端代码-2" class="sidebar-link">前端代码</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#后端代码" class="sidebar-link">后端代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#购物车页面-提交购物车至结算页" class="sidebar-link">购物车页面-提交购物车至结算页</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#前端结算页面" class="sidebar-link">前端结算页面</a></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#结算页面-渲染订单信息" class="sidebar-link">结算页面-渲染订单信息</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-architect/ztc/02/07.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/03/" class="sidebar-heading clickable"><span>03 | 地址、订单、支付、定时任务开发</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/04/" class="sidebar-heading clickable"><span>04 | 用户中心 、订单、评价管理开发</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/05/" class="sidebar-heading clickable"><span>05 | 云服务器部署上线</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-architect/ztc/06/" class="sidebar-heading clickable"><span>06 | LVS + Nginx 实现高可用集群</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/note-architect/ztc/07/" class="sidebar-link">07 | 主从复制高可用 Redis 集群</a></li><li><a href="/note-architect/ztc/08/" class="sidebar-link">08 | Redis 缓存雪崩、穿透</a></li><li><a href="/note-architect/ztc/09/" class="sidebar-link">09 | 分布式会话与单点登录 SSO</a></li><li><a href="/note-architect/ztc/10/" class="sidebar-link">10 | 分布式搜索引擎 Elasticsearch</a></li><li><a href="/note-architect/ztc/11/" class="sidebar-link">11 | 分布式文件系统 FastDFS、阿里 OSS</a></li><li><a href="/note-architect/ztc/12/" class="sidebar-link">12 | 分布式消息队列 RabbitMQ</a></li><li><a href="/note-architect/ztc/13/" class="sidebar-link">13 | 分布式消息队列 Kafka</a></li><li><a href="/note-architect/ztc/14/" class="sidebar-link">14 | 分布式锁</a></li><li><a href="/note-architect/ztc/15/" class="sidebar-link">15 | 读写分离、分库分表 MyCAT 和 Sharding JDBC</a></li><li><a href="/note-architect/ztc/16/" class="sidebar-link">16 | 分布式全局 ID、分布式事务和数据一致性</a></li><li><a href="/note-architect/ztc/17/" class="sidebar-link">17 | 分布式接口幂等性、分布式限流</a></li><li><a href="/note-architect/ztc/18/" class="sidebar-link">18 | 微服务架构认知、服务治理 Eureka</a></li><li><a href="/note-architect/ztc/19/" class="sidebar-link">19 | 负载均衡 Ribbon、服务通信与调用 Feign</a></li><li><a href="/note-architect/ztc/20/" class="sidebar-link">20 | 服务容错 Hystrix</a></li><li><a href="/note-architect/ztc/21/" class="sidebar-link">21 | 分布式配置中心 Config</a></li><li><a href="/note-architect/ztc/22/" class="sidebar-link">22 | 消息总线 Bus、服务网关 Gateway</a></li><li><a href="/note-architect/ztc/23/" class="sidebar-link">23 | 服务调用链追踪 Sleuth、消息驱动 Stream</a></li><li><a href="/note-architect/ztc/24/" class="sidebar-link">24 | 微服务下 Sentinel 流量防控卫兵</a></li><li><a href="/note-architect/ztc/25/" class="sidebar-link">25 | 服务治理的另一条路  Dubbo</a></li><li><a href="/note-architect/ztc/26/" class="sidebar-link">26 | 服务容器化 Docker</a></li><li><a href="/note-architect/ztc/27/" class="sidebar-link">27 | 容器技术 Cloud Foundry</a></li><li><a href="/note-architect/ztc/28/" class="sidebar-link">28 | 容器编排 Mesos + Marathon</a></li><li><a href="/note-architect/ztc/29/" class="sidebar-link">29 | 容器编排 K8S</a></li><li><a href="/note-architect/ztc/30/" class="sidebar-link">30 | 容器弹性扩缩容架构思路</a></li><li><a href="/note-architect/ztc/31/" class="sidebar-link">31 | 高性能网络通信基石 Netty 入门与提高</a></li><li><a href="/note-architect/ztc/32/" class="sidebar-link">32 | 高性能网络通信基石 Netty 最佳实战</a></li><li><a href="/note-architect/ztc/33/" class="sidebar-link">33 | 基于 Netty 打造 RPC 通信框架 1</a></li><li><a href="/note-architect/ztc/34/" class="sidebar-link">34 | 基于 Netty 打造 RPC 通信框架 2</a></li><li><a href="/note-architect/ztc/35/" class="sidebar-link">35 | 应用监控与调优 - 工具篇</a></li><li><a href="/note-architect/ztc/36/" class="sidebar-link">36 | 应用监控与调优 - 技巧与实战篇</a></li><li><a href="/note-architect/ztc/37/" class="sidebar-link">37 | JVM 性能调优 - 理论 + 工具篇</a></li><li><a href="/note-architect/ztc/38/" class="sidebar-link">38 | JVM 性能调优 - 实战篇</a></li><li><a href="/note-architect/ztc/39/" class="sidebar-link">39 | 数据库监控与调优</a></li><li><a href="/note-architect/ztc/40/" class="sidebar-link">40 | Linux 调优与架构调优</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="购物车"><a href="#购物车" class="header-anchor">#</a> 购物车</h1> <p>购物车是电商项目中核心功能之一。</p> <ul><li>线下：把商品放到购物车，然后去收银台结算</li> <li>线上：把商品放到购物车，然后结算，会跳转到收银台页面</li></ul> <p>线上购物车，我们需要考虑两种情况：</p> <ul><li>用户已登录</li> <li>用户未登录</li></ul> <p><img src="/note-architect/assets/img/image-20210216135059033.ea053e6e.png" alt="image-20210216135059033"></p> <h2 id="购物车存储形式分析"><a href="#购物车存储形式分析" class="header-anchor">#</a> 购物车存储形式分析</h2> <h3 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h3> <ul><li>特点：无需登录、无需查库、保存在浏览器端</li> <li>优点：性能好、访问快，没有和数据库交互</li> <li>缺点：
<ul><li>换电脑时，购物车数据会丢失</li> <li>电脑被其他人登录，隐式安全</li></ul></li></ul> <h3 id="session"><a href="#session" class="header-anchor">#</a> Session</h3> <ul><li>特点：用户登录后，购物车数据放入用户会话</li> <li>优点：初期性能较好，访问快</li> <li>缺点：
<ul><li>session 基于内存，用户量庞大影响服务器性能</li> <li>只能存在于当前会话，不适用集群与分布式系统</li></ul></li></ul> <h3 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h3> <ul><li>特点：用户登录后，购物车数据存入数据库</li> <li>优点：数据持久化，可在任何地点任何时间访问</li> <li>缺点：频繁读写数据库，造成数据库压力</li></ul> <h3 id="redis"><a href="#redis" class="header-anchor">#</a> redis</h3> <ul><li>特点：用户登录后，购物车数据存入 redis 缓存</li> <li>优点：
<ul><li>数据持久化，可在任何地点任何时间访问</li> <li>频繁读写只基于缓存，不会造成数据库压力</li> <li>适用于集群与分布式系统，可扩展性强</li></ul></li></ul> <h2 id="技术方案确定"><a href="#技术方案确定" class="header-anchor">#</a> 技术方案确定</h2> <p>本节将会使用如下方案：</p> <ul><li><p>未登录：存放 cookie</p></li> <li><p>已登录：存放在 redis 中</p> <p>由于现阶段，还未讲解 redis，暂时不实现</p></li></ul> <p>也可以去看看京东的购物车，它也是存放在 cookie 中的</p> <h2 id="添加商品到购物车"><a href="#添加商品到购物车" class="header-anchor">#</a> 添加商品到购物车</h2> <h3 id="前端代码示例"><a href="#前端代码示例" class="header-anchor">#</a> 前端代码示例</h3> <p>前端主要代码如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// 由于cookie大小限制为4k，另外课程第一阶段是没有redis的，所以相关暂存性内容会存入到cookie中</span>
					<span class="token keyword">var</span> shopcartCounts <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getShopcartItemCounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>shopcartCounts <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;您购物车中的食物太多啦~请把它们带回家吧~！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// 创建购物车对象</span>
					<span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">;</span>
					<span class="token keyword">var</span> itemImgList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemImgList<span class="token punctuation">;</span>
					<span class="token keyword">var</span> selectedSku <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectedSku<span class="token punctuation">;</span>

					<span class="token keyword">var</span> tmpBuyCounts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>buyCounts<span class="token punctuation">;</span>
					tmpBuyCounts <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>tmpBuyCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>tmpBuyCounts<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;购买数量不能为非数字！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">// tmpBuyCounts = 1;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>buyCounts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// 构建购物车商品对象</span>
					<span class="token keyword">var</span> shopcartItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">app<span class="token punctuation">.</span>ShopcartItem</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
						itemImgList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">,</span>
						item<span class="token punctuation">.</span>itemName<span class="token punctuation">,</span>
						selectedSku<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
						selectedSku<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
						tmpBuyCounts<span class="token punctuation">,</span>
						selectedSku<span class="token punctuation">.</span>priceDiscount<span class="token punctuation">,</span>
						selectedSku<span class="token punctuation">.</span>priceNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// console.log(shopcartItem);</span>
					<span class="token comment">// 添加商品至购物车list</span>
					app<span class="token punctuation">.</span><span class="token function">addItemToShopcart</span><span class="token punctuation">(</span>shopcartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token comment">// 购物车应该在登录/注册的时候同步</span>

					<span class="token comment">// 判断当前用户是否登录，如果登录，则把购物车数据发送至后端（后端需要合并已存在的商品）</span>
					<span class="token keyword">var</span> userIsLogin <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userIsLogin<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>userIsLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">var</span> userInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo<span class="token punctuation">;</span>
						<span class="token keyword">var</span> serverUrl <span class="token operator">=</span> app<span class="token punctuation">.</span>serverUrl<span class="token punctuation">;</span>
						axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
								serverUrl <span class="token operator">+</span> <span class="token string">'/shopcart/add?userId='</span> <span class="token operator">+</span> userInfo<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
								shopcartItem<span class="token punctuation">,</span> <span class="token punctuation">{</span>
									headers<span class="token operator">:</span> <span class="token punctuation">{</span>
										<span class="token string">'headerUserId'</span><span class="token operator">:</span> userInfo<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
										<span class="token string">'headerUserToken'</span><span class="token operator">:</span> userInfo<span class="token punctuation">.</span>userUniqueToken
									<span class="token punctuation">}</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
								<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

								<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
									<span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;商品添加至购物车成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token comment">// 以下仅供测试观察数据</span>
					<span class="token comment">// var foodieShopcartCookie = app.getCookie(&quot;shopcart&quot;);</span>
					<span class="token comment">// var foodieShopcart = [];</span>
					<span class="token comment">// if (foodieShopcartCookie != null &amp;&amp; foodieShopcartCookie != &quot;&quot; &amp;&amp; foodieShopcartCookie != undefined) {</span>
					<span class="token comment">// 	var foodieShopcartStr = decodeURIComponent(foodieShopcartCookie);</span>
					<span class="token comment">// 	foodieShopcart = JSON.parse(foodieShopcartStr);</span>
					<span class="token comment">// }</span>
					<span class="token comment">// console.log(foodieShopcart);</span>

					<span class="token comment">// 刷新购物车数量</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>shopcartItemCounts <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getShopcartItemCounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>这是操作 app.js 中 购物车 相关的代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token comment">/**
   * 构建购物车商品对象
   */</span>
  <span class="token function-variable function">ShopcartItem</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">itemId<span class="token punctuation">,</span> itemImgUrl<span class="token punctuation">,</span> itemName<span class="token punctuation">,</span> specId<span class="token punctuation">,</span> specName<span class="token punctuation">,</span> buyCounts<span class="token punctuation">,</span> priceDiscount<span class="token punctuation">,</span> priceNormal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>itemId <span class="token operator">=</span> itemId
    <span class="token keyword">this</span><span class="token punctuation">.</span>itemImgUrl <span class="token operator">=</span> itemImgUrl
    <span class="token keyword">this</span><span class="token punctuation">.</span>itemName <span class="token operator">=</span> itemName
    <span class="token keyword">this</span><span class="token punctuation">.</span>specId <span class="token operator">=</span> specId
    <span class="token keyword">this</span><span class="token punctuation">.</span>specName <span class="token operator">=</span> specName
    <span class="token keyword">this</span><span class="token punctuation">.</span>buyCounts <span class="token operator">=</span> buyCounts
    <span class="token keyword">this</span><span class="token punctuation">.</span>priceDiscount <span class="token operator">=</span> priceDiscount
    <span class="token keyword">this</span><span class="token punctuation">.</span>priceNormal <span class="token operator">=</span> priceNormal
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">addItemToShopcart</span> <span class="token punctuation">(</span><span class="token parameter">pendingItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断有没有购物车，如果没有购物车，则new 一个购物车list</span>
    <span class="token comment">// 如果有购物车，则直接把shopcartItem丢进去</span>
    <span class="token keyword">var</span> foodieShopcartCookie <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">'shopcart'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> foodieShopcart <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>foodieShopcartCookie <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> foodieShopcartCookie <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> foodieShopcartCookie <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> foodieShopcartStr <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>foodieShopcartCookie<span class="token punctuation">)</span>
      foodieShopcart <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>foodieShopcartStr<span class="token punctuation">)</span>

      <span class="token comment">// 如果不是对象，则重新复制为空数组</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>foodieShopcart<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        foodieShopcart <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> isHavingItem <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token comment">// 如果添加的商品已经存在与购物车中，则购物车中已经存在的商品数量累加新增的</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> foodieShopcart<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> tmpItem <span class="token operator">=</span> foodieShopcart<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">var</span> specId <span class="token operator">=</span> tmpItem<span class="token punctuation">.</span>specId
        <span class="token keyword">if</span> <span class="token punctuation">(</span>specId <span class="token operator">==</span> pendingItem<span class="token punctuation">.</span>specId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isHavingItem <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">var</span> newCounts <span class="token operator">=</span> tmpItem<span class="token punctuation">.</span>buyCounts <span class="token operator">+</span> pendingItem<span class="token punctuation">.</span>buyCounts
          tmpItem<span class="token punctuation">.</span>buyCounts <span class="token operator">=</span> newCounts
          <span class="token comment">// 删除主图在数组中的位置</span>
          foodieShopcart<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tmpItem<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isHavingItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        foodieShopcart<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pendingItem<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      foodieShopcart<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pendingItem<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">'shopcart'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>foodieShopcart<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 获得购物车中的数量
   */</span>
  <span class="token function">getShopcartItemCounts</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断有没有购物车，如果没有购物车，则new 一个购物车list</span>
    <span class="token comment">// 如果有购物车，则直接把shopcartItem丢进去</span>
    <span class="token keyword">var</span> foodieShopcartCookie <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">'shopcart'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> foodieShopcart <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>foodieShopcartCookie <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> foodieShopcartCookie <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">&amp;&amp;</span> foodieShopcartCookie <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> foodieShopcartStr <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>foodieShopcartCookie<span class="token punctuation">)</span>
      foodieShopcart <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>foodieShopcartStr<span class="token punctuation">)</span>

      <span class="token comment">// 如果不是对象，则重新复制为空数组</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>foodieShopcart<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        foodieShopcart <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> foodieShopcart<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>操作 cookie 相关的代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token function-variable function">getCookie</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> cname <span class="token operator">+</span> <span class="token string">'='</span>
    <span class="token keyword">var</span> ca <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ca<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> c <span class="token operator">=</span> ca<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token comment">// console.log(c)</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> c <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>length<span class="token punctuation">,</span> c<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">setCookie</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> Days <span class="token operator">=</span> <span class="token number">365</span>
    <span class="token keyword">var</span> exp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    exp<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>exp<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> Days <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> cookieContent <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">';path=/;'</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cookieContent <span class="token operator">+=</span> <span class="token string">'domain='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain
    <span class="token punctuation">}</span>
    document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> cookieContent
    <span class="token comment">// document.cookie = name + &quot;=&quot;+ encodeURIComponent (value) + &quot;;path=/;domain=&quot; + cookieDomain;//expires=&quot; + exp.toGMTString();</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">deleteCookie</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cookieContent <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">'=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cookieContent <span class="token operator">+=</span> <span class="token string">'domain='</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cookieDomain
    <span class="token punctuation">}</span>
    document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> cookieContent
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>唯一需要注意的是 <code>this.cookieDomain</code> 这个是 app.js 中的配置参数，它设置了 cookie 域，本地测试的话，需要清空该配置，否则购物车功能将看不到 cookie 相关数据。</p> <h3 id="后端保存购物数据接口"><a href="#后端保存购物数据接口" class="header-anchor">#</a> 后端保存购物数据接口</h3> <p>在每次添加商品到购物车时，有一个发往后端的请求 <code>'/shopcart/add?userId=' + userInfo.id,</code> 这个是当用户登录后，添加商品到购物车，则会触发该请求，所以尽管这里不涉及到 redis ，但是我们也需要先把接口实现，什么也不做.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>foodiedev<span class="token punctuation">.</span>api<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>foodiedev<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">JSONResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>foodiedev<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">JsonUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>foodiedev<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>bo<span class="token punctuation">.</span></span><span class="token class-name">ShopcartBO</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiIgnore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;购物车接口&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;shopcart&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShopcatController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">JSONResult</span> <span class="token function">add</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ShopcartBO</span> shopcartBO<span class="token punctuation">,</span>
            <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
            <span class="token class-name">HttpServletResponse</span> response
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">objectToJson</span><span class="token punctuation">(</span>shopcartBO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 这里需要校验是否登录之类的，后续再来完善该代码</span>
        <span class="token comment">// 这里只简单的判定是否有传递 userId</span>
        <span class="token comment">// TODO 前端用户在登录的情况下，添加商品到购物车，会同时在后端同步购物车到 redis 缓存</span>
        <span class="token keyword">return</span> <span class="token class-name">JSONResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>定义 BO 对象，接受参数</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>foodiedev<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>bo</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShopcartBO</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> itemId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> itemImgUrl<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> itemName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> specId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> specName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> buyCounts<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> priceDiscount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> priceNormal<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>然后现在，就可以登录账户，然后添加一个商品到购物车，查看接口是否有正确的接收到传递过来的加购商品信息</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <ul><li>前端：添加一个商品到购物车时时，需要判定是否是同一个商品（specId），如果是需要合并并累加数量</li> <li>后端：在登录状态下，前端添加到购物车时，需要将这个商品发送到后端</li></ul> <h2 id="购物车页面"><a href="#购物车页面" class="header-anchor">#</a> 购物车页面</h2> <p><img src="/note-architect/assets/img/image-20210216135059033.ea053e6e.png" alt="image-20210216135059033"></p> <p>如上图，则是购物车页面。</p> <h2 id="购物车页面-刷新渲染"><a href="#购物车页面-刷新渲染" class="header-anchor">#</a> 购物车页面-刷新渲染</h2> <p>从其他页面进入到购物车页面时，我们渲染购物车页面商品列表，是否可以直接使用 cookie 里面保存的商品信息呢？</p> <p>这里一般不会直接使用 cookie 里面的商品信息，而是需要去后端查询最新的商品信息，再渲染。</p> <h3 id="前端代码"><a href="#前端代码" class="header-anchor">#</a> 前端代码</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">renderShopcart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">var</span> shopcartList <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getShopcartList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token comment">// console.log(shopcartList);</span>
						<span class="token comment">// this.shopcartList = shopcartList;</span>

						<span class="token keyword">if</span> <span class="token punctuation">(</span>shopcartList<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">return</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token comment">// 刷新购物车中价格，以防长时间未登录网址，价格发生变动</span>
						<span class="token comment">// 拼接规格ids</span>
						<span class="token keyword">var</span> itemSpecIds <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
						<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> shopcartList<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">var</span> tmpSpecId <span class="token operator">=</span> shopcartList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>specId<span class="token punctuation">;</span>
							itemSpecIds <span class="token operator">+=</span> tmpSpecId<span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> shopcartList<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								itemSpecIds <span class="token operator">+=</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// 1001，2002，3003，4004</span>

						<span class="token comment">// 请求后端获得最新数据</span>
						<span class="token keyword">var</span> serverUrl <span class="token operator">=</span> app<span class="token punctuation">.</span>serverUrl<span class="token punctuation">;</span>
							axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
							axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
									serverUrl <span class="token operator">+</span> <span class="token string">'/items/refresh?itemSpecIds='</span> <span class="token operator">+</span> itemSpecIds<span class="token punctuation">,</span> 
									<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
									<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
											<span class="token keyword">var</span> newItemList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
											<span class="token comment">// 删除现有购物车cookie</span>
											app<span class="token punctuation">.</span><span class="token function">deleteCookie</span><span class="token punctuation">(</span><span class="token string">&quot;shopcart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
											<span class="token comment">// console.log(newItemList);</span>
											<span class="token comment">// 拿到最新商品数据以后，重新组合成购物车数据</span>
											<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newItemList<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
												<span class="token keyword">var</span> tmpNewItem <span class="token operator">=</span> newItemList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
												<span class="token keyword">var</span> tmpNewItemSpecId <span class="token operator">=</span> tmpNewItem<span class="token punctuation">.</span>specId<span class="token punctuation">;</span>
												<span class="token keyword">var</span> buyCounts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBuyCountsFromCookieShopcartList</span><span class="token punctuation">(</span>shopcartList<span class="token punctuation">,</span> tmpNewItemSpecId<span class="token punctuation">)</span><span class="token punctuation">;</span>
												<span class="token comment">// console.log(buyCounts);</span>

												<span class="token comment">// 构建购物车商品对象</span>
												<span class="token keyword">var</span> shopcartItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">app<span class="token punctuation">.</span>ShopcartItem</span><span class="token punctuation">(</span>tmpNewItem<span class="token punctuation">.</span>itemId<span class="token punctuation">,</span> 
																						tmpNewItem<span class="token punctuation">.</span>itemImgUrl<span class="token punctuation">,</span>
																						tmpNewItem<span class="token punctuation">.</span>itemName<span class="token punctuation">,</span> 
																						tmpNewItem<span class="token punctuation">.</span>specId<span class="token punctuation">,</span> 
																						tmpNewItem<span class="token punctuation">.</span>specName<span class="token punctuation">,</span> 
																						buyCounts<span class="token punctuation">,</span> 
																						tmpNewItem<span class="token punctuation">.</span>priceDiscount<span class="token punctuation">,</span> 
																						tmpNewItem<span class="token punctuation">.</span>priceNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
												<span class="token comment">// 添加商品至购物车list</span>
												app<span class="token punctuation">.</span><span class="token function">addItemToShopcart</span><span class="token punctuation">(</span>shopcartItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
											<span class="token punctuation">}</span>
											<span class="token comment">// 重新获取cookie中的商品list渲染到页面</span>
											shopcartList <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getShopcartList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
											<span class="token comment">// console.log(shopcartList);</span>
											<span class="token keyword">this</span><span class="token punctuation">.</span>shopcartList <span class="token operator">=</span> shopcartList<span class="token punctuation">;</span>	
										<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
											<span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
										<span class="token punctuation">}</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						

					<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>做的事情如下：</p> <ol><li>从 cookie 中获取到了商品信息，并将规格 ID 拼接成参数列表</li> <li>去服务器端批量获取商品信息</li> <li>删除本地 cookie 中的购物车数据</li> <li>将从服务器端获取到的商品数据添加到购物中（只有购买数量是 cookie 里面的）</li></ol> <p>那么就要实现该接口</p> <h3 id="查询最新商品数据接口"><a href="#查询最新商品数据接口" class="header-anchor">#</a> 查询最新商品数据接口</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t_items<span class="token punctuation">.</span>id                  <span class="token keyword">as</span> itemId<span class="token punctuation">,</span>
       t_items<span class="token punctuation">.</span>item_name           <span class="token keyword">as</span> itemName<span class="token punctuation">,</span>
       t_items_img<span class="token punctuation">.</span>url             <span class="token keyword">as</span> itemImgUrl<span class="token punctuation">,</span>
       t_items_spec<span class="token punctuation">.</span>id             <span class="token keyword">as</span> specId<span class="token punctuation">,</span>
       t_items_spec<span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span>         <span class="token keyword">as</span> specName<span class="token punctuation">,</span>
       t_items_spec<span class="token punctuation">.</span>price_discount <span class="token keyword">as</span> priceDiscount<span class="token punctuation">,</span>
       t_items_spec<span class="token punctuation">.</span>price_normal   <span class="token keyword">as</span> priceNormal
<span class="token keyword">FROM</span> items_spec t_items_spec
         <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
     items t_items
     <span class="token keyword">ON</span>
         t_items<span class="token punctuation">.</span>id <span class="token operator">=</span> t_items_spec<span class="token punctuation">.</span>item_id
         <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
     items_img t_items_img
     <span class="token keyword">on</span>
         t_items_img<span class="token punctuation">.</span>item_id <span class="token operator">=</span> t_items<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> t_items_img<span class="token punctuation">.</span>is_main <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token operator">AND</span> t_items_spec<span class="token punctuation">.</span>id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'bingan-1001-spec-1'</span><span class="token punctuation">,</span><span class="token string">'bingan-1001-spec-2'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><table><thead><tr><th style="text-align:left;">itemId</th> <th style="text-align:left;">itemName</th> <th style="text-align:left;">itemImgUrl</th> <th style="text-align:left;">specId</th> <th style="text-align:left;">specName</th> <th style="text-align:left;">priceDiscount</th> <th style="text-align:left;">priceNormal</th></tr></thead> <tbody><tr><td style="text-align:left;">bingan-1001</td> <td style="text-align:left;">【天天吃货】彩虹马卡龙 下午茶 美眉最爱</td> <td style="text-align:left;">http://122.152.205.72:88/foodie/bingan-1001/img1.png</td> <td style="text-align:left;">bingan-1001-spec-1</td> <td style="text-align:left;">巧克力</td> <td style="text-align:left;">12000</td> <td style="text-align:left;">15000</td></tr> <tr><td style="text-align:left;">bingan-1001</td> <td style="text-align:left;">【天天吃货】彩虹马卡龙 下午茶 美眉最爱</td> <td style="text-align:left;">http://122.152.205.72:88/foodie/bingan-1001/img1.png</td> <td style="text-align:left;">bingan-1001-spec-2</td> <td style="text-align:left;">草莓水果</td> <td style="text-align:left;">9000</td> <td style="text-align:left;">15000</td></tr></tbody></table> <p>mapper</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShopcartVO</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;paramsList&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span> specIdsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>queryItemsBySpecIds<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>List<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.mrcode.foodiedev.pojo.vo.ShopcartVO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT t_items.id                  as itemId,
               t_items.item_name           as itemName,
               t_items_img.url             as itemImgUrl,
               t_items_spec.id             as specId,
               t_items_spec.`name`         as specName,
               t_items_spec.price_discount as priceDiscount,
               t_items_spec.price_normal   as priceNormal
        FROM items_spec t_items_spec
                 LEFT JOIN
             items t_items
             ON
                 t_items.id = t_items_spec.item_id
                 LEFT JOIN
             items_img t_items_img
             on
                 t_items_img.item_id = t_items.id
        WHERE t_items_img.is_main = 1
          AND t_items_spec.id IN
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paramsList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>specId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>,<span class="token punctuation">&quot;</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                #{specId}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>VO</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShopcartVO</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> itemId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> itemImgUrl<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> itemName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> specId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> specName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> priceDiscount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> priceNormal<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>service</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>SUPPORTS<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShopcartVO</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span><span class="token class-name">String</span> specIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> ids<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> specIds<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> specIdsList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>specIdsList<span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> itemsMapperCustom<span class="token punctuation">.</span><span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span>specIdsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>controller</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// 用于用户长时间未登录网站，刷新购物车中的数据（主要是商品价格），类似京东淘宝</span>
    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;根据商品规格 ids 查找最新的商品数据&quot;</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">&quot;根据商品规格 ids 查找最新的商品数据&quot;</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/refresh&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">JSONResult</span> <span class="token function">refresh</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;itemSpecIds&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;拼接的规格ids&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">&quot;1001,1003,1005&quot;</span><span class="token punctuation">)</span>
            <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> itemSpecIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>itemSpecIds<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">JSONResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShopcartVO</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> itemService<span class="token punctuation">.</span><span class="token function">queryItemsBySpecIds</span><span class="token punctuation">(</span>itemSpecIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">JSONResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="购物车页面-选中商品业务"><a href="#购物车页面-选中商品业务" class="header-anchor">#</a> 购物车页面-选中商品业务</h2> <p><img src="/note-architect/assets/img/image-20210216151801072.4d083151.png" alt="image-20210216151801072"></p> <p>如上图，选中商品，计算他们的价格，这里代码是前端的一个效果。</p> <h2 id="购物车页面-删除商品业务"><a href="#购物车页面-删除商品业务" class="header-anchor">#</a> 购物车页面-删除商品业务</h2> <p>删除购物车商品时，同样需要考虑「登录」和「未登录」：</p> <ul><li>未登录：只需要删除本地  cookie 中的数据即可</li> <li>已登录：还需要删除服务端购物车数据</li></ul> <h3 id="前端代码-2"><a href="#前端代码-2" class="header-anchor">#</a> 前端代码</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>					<span class="token comment">// 从购物车中删除商品</span>
					<span class="token function">delFromCart</span><span class="token punctuation">(</span><span class="token parameter">specId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// console.log(specId);</span>

						<span class="token keyword">var</span> bool <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;确认从购物车中移除该商品吗？&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">return</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						
						<span class="token comment">// 删除cookie中的商品</span>
						<span class="token keyword">var</span> shopcartList <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getShopcartList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> shopcartList<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">var</span> tmpItem <span class="token operator">=</span> shopcartList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>tmpItem<span class="token punctuation">.</span>specId <span class="token operator">==</span> specId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								shopcartList<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">break</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// 重新放入cookie，更新一下</span>
						app<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">&quot;shopcart&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>shopcartList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>shopcartList <span class="token operator">=</span> shopcartList<span class="token punctuation">;</span>

						<span class="token comment">// 清除选中项</span>
						<span class="token keyword">var</span> specIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specIds<span class="token punctuation">;</span>
						<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> specIds<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">var</span> tmpSpecId <span class="token operator">=</span> specIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>specId <span class="token operator">==</span> tmpSpecId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								specIds<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
            <span class="token comment">// 重新计算购物车中选中的件数以及总价格</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reCalItemsCountsAndAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token comment">// 如果用户是已经登录状态，需要再把redis中的购物车商品删除</span>
						<span class="token keyword">var</span> userIsLogin <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userIsLogin<span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>userIsLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">var</span> userInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo<span class="token punctuation">;</span>
							<span class="token keyword">var</span> serverUrl <span class="token operator">=</span> app<span class="token punctuation">.</span>serverUrl<span class="token punctuation">;</span>
							axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
							axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
									serverUrl <span class="token operator">+</span> <span class="token string">'/shopcart/del?userId='</span> <span class="token operator">+</span> userInfo<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'&amp;itemSpecId='</span> <span class="token operator">+</span> specId<span class="token punctuation">,</span> 
									<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
									<span class="token punctuation">{</span>
										headers<span class="token operator">:</span> <span class="token punctuation">{</span>
											<span class="token string">'headerUserId'</span><span class="token operator">:</span> userInfo<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
											<span class="token string">'headerUserToken'</span><span class="token operator">:</span> userInfo<span class="token punctuation">.</span>userUniqueToken
										<span class="token punctuation">}</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span>
									<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
										<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
											
										<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
											<span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
										<span class="token punctuation">}</span>
									<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

					<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>大致步骤如下：</p> <ol><li>获取 cookie 中的商品列表信息</li> <li>将选中删除的从列表中删除</li> <li>更新 cookie 的信息</li> <li>重新计算购物车中选中的件数以及总价格</li> <li>如果是已经登录用户，删除后端购物车中的数据</li></ol> <h3 id="后端代码"><a href="#后端代码" class="header-anchor">#</a> 后端代码</h3> <p><code>/shopcart/del?userId=' + userInfo.id + '&amp;itemSpecId=' + specId</code></p> <p>后端接口提供了删除购物车中的数据。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;从购物车中删除商品&quot;</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">&quot;从购物车中删除商品&quot;</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/del&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">JSONResult</span> <span class="token function">del</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> itemSpecId<span class="token punctuation">,</span>
            <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
            <span class="token class-name">HttpServletResponse</span> response
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>itemSpecId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">JSONResult</span><span class="token punctuation">.</span><span class="token function">errorMsg</span><span class="token punctuation">(</span><span class="token string">&quot;参数不能为空&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// TODO 用户在页面删除购物车中的商品数据，如果此时用户已经登录，则需要同步删除后端购物车中的商品</span>

        <span class="token keyword">return</span> <span class="token class-name">JSONResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>由于后端涉及到 redis 与用户认证之类的信息，本阶段暂未涉及，只提供空接口实现即可</p> <h2 id="购物车页面-提交购物车至结算页"><a href="#购物车页面-提交购物车至结算页" class="header-anchor">#</a> 购物车页面-提交购物车至结算页</h2> <p>将选中的商品，点击结算，将跳转到结算页，这里需要先登录才能结算。如果点击结算时，没有登录，则会自动跳转到登录页面，登录成功后，会自动跳转到购物车页面。</p> <p><img src="/note-architect/assets/img/image-20210216153644052.f8d0bd29.png" alt="image-20210216153644052"></p> <h3 id="前端结算页面"><a href="#前端结算页面" class="header-anchor">#</a> 前端结算页面</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>				<span class="token comment">// 前往结算页面</span>
					<span class="token function">goPay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">var</span> shopcartList <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getShopcartList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>shopcartList<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;购物车中没有商品，无法结算&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">return</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token keyword">var</span> selectedItemSpecIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specIds<span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>selectedItemSpecIds<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;请至少在购物车中选择一个商品后再结算&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">return</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token comment">// 判断是否登录</span>
						<span class="token keyword">var</span> userIsLogin <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userIsLogin<span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>userIsLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">var</span> specIdsStr <span class="token operator">=</span> selectedItemSpecIds<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;pay.html?selectedItemSpecIds=&quot;</span> <span class="token operator">+</span> specIdsStr<span class="token punctuation">;</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token keyword">var</span> bool <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;请登录/注册后再进行结算操作噢~！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token keyword">return</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
								<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">goLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>大致流程：</p> <ol><li>获取到已选商品 ID（specIds）</li> <li>判断是否登录，没有登录则跳转到登录页面</li> <li>已经登录，则直接跳转到 <code>&quot;pay.html?selectedItemSpecIds=&quot; + specIdsStr;</code> 页面</li></ol> <p>该功能不涉及到后端功能。</p> <h3 id="结算页面-渲染订单信息"><a href="#结算页面-渲染订单信息" class="header-anchor">#</a> 结算页面-渲染订单信息</h3> <p>从购物车点击 结算，后跳转到 结算页面，其中之一需要做的事情就是，显示提交的商品信息</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">renderOrderInfoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> selectedItemSpecIds <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getUrlParam</span><span class="token punctuation">(</span><span class="token string">&quot;selectedItemSpecIds&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedItemSpecIds <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> selectedItemSpecIds <span class="token operator">==</span> <span class="token string">''</span> <span class="token operator">||</span> selectedItemSpecIds <span class="token operator">==</span>
  <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">goErrorPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">var</span> specIdsArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 specIdsArray <span class="token operator">=</span> selectedItemSpecIds<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">var</span> orderItemList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> totalAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> specIdsArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> tmpSpecId <span class="token operator">=</span> specIdsArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> orderItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getItemFromCookieShopcartList</span><span class="token punctuation">(</span>tmpSpecId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  orderItemList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  totalAmount <span class="token operator">+=</span> <span class="token punctuation">(</span>orderItem<span class="token punctuation">.</span>priceDiscount <span class="token operator">*</span> orderItem<span class="token punctuation">.</span>buyCounts<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// console.log(orderItemList);</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>orderItemList <span class="token operator">=</span> orderItemList<span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>totalAmount <span class="token operator">=</span> totalAmount<span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>orderItemList<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;没有商品信息，或订单已经提交&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;shopcart.html&quot;</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>大致流程如下：</p> <ol><li>从 URL 中获得选择的商品 ID</li> <li>从 cookie 里面获取到商品信息，包装成 orderItem</li> <li>计算选中商品的总价格</li></ol> <p>结算中的其他业务则属于订单相关业务了，后续再继续讲解。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>购物车的主要业务如下：</p> <ol><li><p>添加商品到购物车</p> <p>需要考虑到用户已登录或未登录的情况：</p> <ul><li>未登录：只将选中商品数据存储在 cookie 中</li> <li>已登录：还需要将选中商品数据发往后端服务，存储在 redis 中</li></ul></li> <li><p>查看购物中的商品</p> <p>这里不能直接使用 cookie 中的商品信息，需要从后端服务获取最新的商品信息，主要是商品价格，因为购物车的商品大部分情况下，不是即使被查看，有可能已经过了很久了</p></li> <li><p>选中购物车商品，查看总价格</p> <p>挑选想要购买的商品，查看选中商品的价格</p></li> <li><p>提交购物商品，到结算页面</p> <p>正式进入到订单业务</p></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/note-architect/edit/main/docs/ztc/02/07.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-06-22 09:57:38</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-architect/ztc/02/06.html" class="prev">
        搜索商品
      </a></span> <span class="next"><a href="/note-architect/ztc/03/01.html">
        收货地址
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/note-architect/assets/js/app.802a2e28.js" defer></script><script src="/note-architect/assets/js/2.c5658f11.js" defer></script><script src="/note-architect/assets/js/45.43ef5aaf.js" defer></script><script src="/note-architect/assets/js/49.c0fbdc86.js" defer></script>
  </body>
</html>
